import{c as S,A,S as I}from"./loadSts-g3N6oVRQ.js";import{b as L,E as q,e as M,I as N,d as U,M as z,P as B,R as F,a as V}from"./loadSts-g3N6oVRQ.js";import{C as y,g as E,s as l}from"./index-Dt_WCYUq.js";import{a as G}from"./index-Dt_WCYUq.js";import"./index-BL2DSSQ0.js";import"./toUtf8.browser-CyauOOnS.js";function R(){return async()=>"us-east-1"}class x extends y.classBuilder().ep(S).m(function(t,o,i,n){return[E(i,t.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRoleWithWebIdentity",{}).n("STSClient","AssumeRoleWithWebIdentityCommand").sc(A).build(){}const W=e=>{if(typeof e?.Arn=="string"){const t=e.Arn.split(":");if(t.length>4&&t[4]!=="")return t[4]}},T=async(e,t,o,i={})=>{const n=typeof e=="function"?await e():e,s=typeof t=="function"?await t():t,r=await R()();return o?.debug?.("@aws-sdk/client-sts::resolveRegion","accepting first of:",`${n} (credential provider clientConfig)`,`${s} (contextual client)`,`${r} (STS default: AWS_REGION, profile region, or us-east-1)`),n??s??r},b=(e,t)=>{let o;return async i=>{if(!o){const{logger:d=e?.parentClientConfig?.logger,profile:u=e?.parentClientConfig?.profile,region:m,requestHandler:c=e?.parentClientConfig?.requestHandler,credentialProviderLogger:f,userAgentAppId:g=e?.parentClientConfig?.userAgentAppId}=e,p=await T(m,e?.parentClientConfig?.region,f,{}),C=!h(c);o=new t({...e,userAgentAppId:g,profile:u,region:p,requestHandler:C?c:void 0,logger:d})}const{Credentials:n,AssumedRoleUser:s}=await o.send(new x(i));if(!n||!n.AccessKeyId||!n.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRoleWithWebIdentity call with role ${i.RoleArn}`);const r=W(s),a={accessKeyId:n.AccessKeyId,secretAccessKey:n.SecretAccessKey,sessionToken:n.SessionToken,expiration:n.Expiration,...n.CredentialScope&&{credentialScope:n.CredentialScope},...r&&{accountId:r}};return r&&l(a,"RESOLVED_ACCOUNT_ID","T"),l(a,"CREDENTIALS_STS_ASSUME_ROLE_WEB_ID","k"),a}},h=e=>e?.metadata?.handlerProtocol==="h2",w=(e,t)=>t?class extends e{constructor(i){super(i);for(const n of t)this.middlewareStack.use(n)}}:e,_=(e={},t)=>b(e,w(I,t));export{y as $Command,L as AssumeRoleCommand,x as AssumeRoleWithWebIdentityCommand,q as ExpiredTokenException,M as IDPCommunicationErrorException,N as IDPRejectedClaimException,U as InvalidIdentityTokenException,z as MalformedPolicyDocumentException,B as PackedPolicyTooLargeException,F as RegionDisabledException,I as STSClient,V as STSServiceException,G as __Client,_ as getDefaultRoleAssumerWithWebIdentity};
